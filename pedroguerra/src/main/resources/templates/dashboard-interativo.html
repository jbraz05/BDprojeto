<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard Interativo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/dashboard-interativo.css">
</head>
<body>
    <h1>Dashboard Interativo</h1>

    <form method="post" th:action="@{/dashboard-interativo}">
        <label>Escolha a entidade:</label>
        <select name="entidade">
            <option value="empresa">Empresa</option>
            <option value="cliente">Cliente</option>
            <option value="funcionario">Funcionário</option>
        </select>

        <label>Escolha a métrica:</label>
        <select name="metrica">
            <option value="quantidade">Quantidade de Serviços</option>
            <option value="valor">Valor Total das Medições</option>
            <option value="area">Área Total (ha)</option>
            <option value="concluidos">Serviços Concluídos</option>
            <option value="tempo">Tempo Médio Total (dias)</option>
        </select>

        <button type="submit">Gerar Gráfico</button>
    </form>

    <div th:if="${dados}">
        <canvas id="grafico"></canvas>

        <script th:inline="javascript">
            /*<![CDATA[*/
            let rawData = /*[[${dados}]]*/ {};
            let labels = Object.keys(rawData);
            let valores = Object.values(rawData);

            new Chart(document.getElementById('grafico'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Resultado',
                        data: valores,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: '[[${tituloGrafico}]]'
                        }
                    }
                }
            });
            /*]]>*/
        </script>
    </div>
</body>
</html>
