<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Funcionário</title>
</head>
<body>
    <h1>Cadastro de Funcionário</h1>

    <form id="funcionarioForm">
        <label>Tipo de Funcionário:</label><br>
        <select name="tipo" required>
            <option value="engenheiro">Engenheiro</option>
            <option value="operador">Operador de Drone</option>
            <option value="socio">Sócio</option>
        </select><br><br>

        <label>Matrícula:</label><br>
        <input type="text" name="matricula" required><br><br>

        <label>Nome:</label><br>
        <input type="text" name="nome" required><br><br>

        <label>Contato:</label><br>
        <input type="text" name="contato"><br><br>

        <label>Rua:</label><br>
        <input type="text" name="rua"><br><br>

        <label>Número:</label><br>
        <input type="text" name="numero"><br><br>

        <label>Bairro:</label><br>
        <input type="text" name="bairro"><br><br>

        <label>Cidade:</label><br>
        <input type="text" name="cidade"><br><br>

        <label>Supervisor (Matrícula):</label><br>
        <input type="text" name="supervisor"><br><br>

        <button type="submit">Cadastrar</button>
    </form>

    <div id="resultado"></div>

    <script>
        document.getElementById("funcionarioForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const tipo = event.target.tipo.value;
            const dadosFuncionario = {
                matricula: event.target.matricula.value,
                nome: event.target.nome.value,
                contato: event.target.contato.value,
                rua: event.target.rua.value,
                numero: event.target.numero.value,
                bairro: event.target.bairro.value,
                cidade: event.target.cidade.value,
                fkSupervisorMatricula: event.target.supervisor.value
            };

            // 1. Cadastra o funcionário em geral
            fetch("/funcionario/cadastrar", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dadosFuncionario)
            })
            .then(res => res.text())
            .then(() => {
                // 2. Cadastra o tipo específico
                return fetch("/" + tipo + "/cadastrar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ matricula: dadosFuncionario.matricula })
                });
            })
            .then(res => res.text())
            .then(msg => {
                document.getElementById("resultado").innerText = "Funcionário cadastrado: " + msg;
            })
            .catch(err => {
                document.getElementById("resultado").innerText = "Erro ao cadastrar: " + err;
            });
        });
    </script>
</body>
</html>
