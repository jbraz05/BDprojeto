<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Serviço</title>
</head>
<body>
    <h1>Cadastro de Serviço</h1>

    <form id="servicoForm">
        <!-- Empresa -->
        <h3>Empresa</h3>
        CNPJ: <input type="text" name="empresa_cnpj"><br>
        Nome: <input type="text" name="empresa_nome"><br>

        <!-- Cliente -->
        <h3>Cliente</h3>
        CPF/CNPJ: <input type="text" name="cliente_cnpjCpf"><br>
        Nome: <input type="text" name="cliente_nome"><br>
        Pessoa Física? <input type="checkbox" name="pessoaFisica"><br>

        <!-- Serviço -->
        <h3>Serviço</h3>
        ID: <input type="text" name="servico_id"><br>
        Tipo: <input type="text" name="servico_tipo" placeholder="mapeamento ou voo"><br>
        Data: <input type="date" name="servico_data"><br>

        <!-- Relatório -->
        <h3>Relatório</h3>
        Área (m²): <input type="number" step="0.01" name="relatorio_area"><br>
        Data: <input type="date" name="relatorio_data"><br>
        Observações: <input type="text" name="relatorio_observacoes"><br>

        <!-- Localização -->
        <h3>Localização</h3>
        Código: <input type="text" name="localizacao_codigo"><br>
        Estado: <input type="text" name="localizacao_estado"><br>
        País: <input type="text" name="localizacao_pais"><br>
        Região: <input type="text" name="localizacao_regiao"><br>

        <!-- Funcionários -->
        <h3>Funcionários</h3>
        Engenheiro (matrícula): <input type="text" name="engenheiro_matricula"><br>
        Operador Drone (matrícula): <input type="text" name="operador_matricula"><br>
        Sócio (matrícula): <input type="text" name="socio_matricula"><br>

        <!-- Nota Fiscal -->
        <h3>Contrato</h3>
        Nota Fiscal: <input type="text" name="notaFiscal"><br>

        <button type="submit">Cadastrar Serviço</button>
    </form>

    <p id="resposta"></p>

    <script>
        document.getElementById("servicoForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const form = event.target;
            const data = {
                empresa: {
                    cnpj: form.empresa_cnpj.value,
                    nome: form.empresa_nome.value
                },
                cliente: {
                    cnpjCpf: form.cliente_cnpjCpf.value,
                    nome: form.cliente_nome.value
                },
                pessoaFisica: form.pessoaFisica.checked,
                servico: {
                    id: form.servico_id.value,
                    tipo: form.servico_tipo.value,
                    data: form.servico_data.value
                },
                relatorio: {
                    fk_Servico_id: form.servico_id.value,
                    area: parseFloat(form.relatorio_area.value),
                    data: form.relatorio_data.value,
                    observacoes: form.relatorio_observacoes.value
                },
                localizacao: {
                    codigo: form.localizacao_codigo.value,
                    nome_estado: form.localizacao_estado.value,
                    nome_pais: form.localizacao_pais.value,
                    regiao: form.localizacao_regiao.value
                },
                engenheiro: {
                    matricula: form.engenheiro_matricula.value
                },
                operador: {
                    matricula: form.operador_matricula.value
                },
                socio: {
                    matricula: form.socio_matricula.value
                },
                notaFiscal: form.notaFiscal.value
            };

            fetch("/servico/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            })
            .then(response => response.text())
            .then(result => {
                document.getElementById("resposta").innerText = result;
            })
            .catch(error => {
                console.error("Erro:", error);
                document.getElementById("resposta").innerText = "Erro ao enviar dados.";
            });
        });
    </script>
</body>
</html>
