<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro Completo de Serviço</title>
</head>
<body>
  <h1>Cadastro Completo de Serviço</h1>

  <form id="servicoForm">
    <fieldset>
      <legend>Empresa</legend>
      <input name="empresa.cnpj" placeholder="CNPJ" required><br>
      <input name="empresa.nome" placeholder="Nome" required><br>
      <input name="empresa.contato" placeholder="Contato"><br>
      <input name="empresa.rua" placeholder="Rua"><br>
      <input name="empresa.numero" placeholder="Número"><br>
      <input name="empresa.bairro" placeholder="Bairro"><br>
      <input name="empresa.cidade" placeholder="Cidade"><br>
    </fieldset>

    <fieldset>
      <legend>Cliente</legend>
      <select name="pessoaFisica">
        <option value="true">Pessoa Física</option>
        <option value="false">Pessoa Jurídica</option>
      </select><br>
      <input name="cliente.cnpjCpf" placeholder="CPF ou CNPJ" required><br>
      <input name="cliente.nome" placeholder="Nome" required><br>
      <input name="cliente.rua" placeholder="Rua"><br>
      <input name="cliente.numero" placeholder="Número"><br>
      <input name="cliente.bairro" placeholder="Bairro"><br>
    </fieldset>

    <fieldset>
      <legend>Localização de Atuação</legend>
      <input name="localizacao.codigo" placeholder="Código" required><br>
      <input name="localizacao.nomePais" placeholder="Nome do País"><br>
      <input name="localizacao.nomeEstado" placeholder="Nome do Estado"><br>
      <input name="localizacao.regiao" placeholder="Região"><br>
    </fieldset>

    <fieldset>
      <legend>Engenheiro</legend>
      <input name="engenheiro.matricula" placeholder="Matrícula" required><br>
      <input name="engenheiro.nome" placeholder="Nome"><br>
      <input name="engenheiro.contato" placeholder="Contato"><br>
      <input name="engenheiro.rua" placeholder="Rua"><br>
      <input name="engenheiro.numero" placeholder="Número"><br>
      <input name="engenheiro.bairro" placeholder="Bairro"><br>
      <input name="engenheiro.cidade" placeholder="Cidade"><br>
    </fieldset>

    <fieldset>
      <legend>Operador de Drone</legend>
      <input name="operador.matricula" placeholder="Matrícula" required><br>
      <input name="operador.nome" placeholder="Nome"><br>
      <input name="operador.contato" placeholder="Contato"><br>
      <input name="operador.rua" placeholder="Rua"><br>
      <input name="operador.numero" placeholder="Número"><br>
      <input name="operador.bairro" placeholder="Bairro"><br>
      <input name="operador.cidade" placeholder="Cidade"><br>
    </fieldset>

    <fieldset>
      <legend>Sócio</legend>
      <input name="socio.matricula" placeholder="Matrícula" required><br>
      <input name="socio.nome" placeholder="Nome"><br>
      <input name="socio.contato" placeholder="Contato"><br>
      <input name="socio.rua" placeholder="Rua"><br>
      <input name="socio.numero" placeholder="Número"><br>
      <input name="socio.bairro" placeholder="Bairro"><br>
      <input name="socio.cidade" placeholder="Cidade"><br>
    </fieldset>

    <fieldset>
      <legend>Serviço</legend>
      <input name="servico.id" placeholder="ID do Serviço" required><br>
      <input name="servico.data" type="date" required><br>
      <select name="servico.tipo">
        <option value="mapeamento">Mapeamento Tradicional</option>
        <option value="voo">Voo Panorâmico</option>
      </select><br>
      <input name="servico.fkFuncionarioMatricula" placeholder="Matrícula do Responsável"><br>
    </fieldset>

    <fieldset>
      <legend>Relatório</legend>
      <input name="relatorio.fkServicoId" placeholder="ID do Serviço"><br>
      <input name="relatorio.area" placeholder="Área (em km²)" type="number" step="0.1"><br>
      <input name="relatorio.data" type="date"><br>
      <textarea name="relatorio.observacoes" placeholder="Observações"></textarea><br>
    </fieldset>

    <fieldset>
      <legend>Nota Fiscal</legend>
      <input name="notaFiscal" placeholder="Número da Nota Fiscal" required><br>
    </fieldset>

    <button type="submit">Cadastrar Serviço</button>
  </form>

  <div id="resultado"></div>

  <script>
    const form = document.getElementById("servicoForm");

    form.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = new FormData(form);
      const obj = {};
      formData.forEach((value, key) => {
        const keys = key.split(".");
        if (keys.length === 1) {
          obj[keys[0]] = value;
        } else {
          obj[keys[0]] = obj[keys[0]] || {};
          obj[keys[0]][keys[1]] = value;
        }
      });

      obj.pessoaFisica = obj.pessoaFisica === "true";

      fetch("/servico/cadastrar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(obj)
      })
      .then(res => res.text())
      .then(msg => {
        document.getElementById("resultado").innerText = msg;
      })
      .catch(err => {
        document.getElementById("resultado").innerText = "Erro ao cadastrar: " + err;
      });
    });
  </script>
</body>
</html>
